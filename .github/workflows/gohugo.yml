name: CI
on:
   # –°–æ–±—ã—Ç–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–ø—É—Å–∫–∞—é—Ç jobs
    push:
      branches: [ "main" ]
    pull_request:
      branches: [ "main" ]

#permissions:
#  contents: write

jobs: # jobs –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ, –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å
  deploy: # –ù–∞–∑–≤–∞–Ω–∏–µ job –≤—ã –º–æ–∂–µ—Ç–µ –Ω–∞–∑–≤–∞—Ç—å –∫–∞–∫ —É–≥–æ–¥–Ω–æ
    runs-on: ubuntu-22.04 # –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –≤ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ, –≤ –∫–æ—Ç–æ—Ä–æ–π –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –ø—Ä–æ—Ü–µ—Å—Å—ã
#    concurrency:
#      group: ${{ github.workflow }}-${{ github.ref }}
    steps:
      - name: Git checkout # Actions –æ—Ç github: –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π, –≥–∏—Ç –∏ —Ç.–¥.
        uses: actions/checkout@v4
        with:
          submodules: true  # Fetch Hugo themes (true OR recursive)
          fetch-depth: 0    # Fetch all history for .GitInfo and .Lastmod

#      - name: Update theme
        # (Optional)If you have the theme added as submodule, you can pull it and use the most updated version
#        run: git submodule update --init --recursive

      - name: Setup hugo
        uses: peaceiris/actions-hugo@v3
        with:
          hugo-version: '0.135.0'
          extended: true

      - name: Build
        # remove --minify tag if you do not need it
        # docs: https://gohugo.io/hugo-pipes/minification/
        run: hugo --minify

      - name: Deploy
        uses: peaceiris/actions-gh-pages@v3
        if: github.ref == 'refs/heads/main'
        with:
          github_token: ${{ secrets.MYSITE_TOKEN }}
          publish_dir: ./public

      - name: Set up WireGuard Connection
        uses: niklaskeerl/easy-wireguard-action@v2
        with:
          WG_CONFIG_FILE: ${{ secrets.WG_CONFIG_FILE_SPEEDSTER }}


      - name: üìÇ Sync files
        uses: SamKirkland/FTP-Deploy-Action@4.3.2
        with:
          server: ${{ secrets.LINK_FTP_SPBU }}
          username: ${{ secrets.USERNAME_FPT_SPBU }}
          password: ${{ secrets.PASS_FTP_SPBU }}
          local-dir: ./public/


         